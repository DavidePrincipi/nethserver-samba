[global]

# Disable logging, will add parameters to allow configuration of logging in the future
log level = 0

# Only bind to allowed NIC's
bind interfaces only = yes
interfaces = 127.0.0.1 {
    use esmith::NetworksDB;
    use esmith::util;
    $ndb = esmith::NetworksDB->open_ro() || return '';
    my @nets;
    foreach ($ndb->green()) {
        my $LocalIP = $_->prop('ipaddr') || next;
        my $LocalNetmask = $_->prop('netmask') || next;
        push(@nets, esmith::util::computeLocalNetworkShortSpec($LocalIP, $LocalNetmask));
    }

    return join(' ',@nets);
}
hosts allow = { join(' ', @hostsAllow) }

# Idle time before disconnecting the client
deadtime = { int($smb{DeadTime}) }

workgroup = { $workgroup }

# Alias NETBIOS names, used to provide access to Samba via multiple hostnames

netbios aliases = { join(' ', @netbiosAliasList) }
server string = NethServer Samba %v
security = { $smb{ServerRole} eq 'ADS' ? 'ADS' : 'user' }

; WINS setup {
  if(grep { $_->prop('ipaddr') eq ($smb{WinsServerIP} || '') } $ndb->green) {
    $winsServerIp = '';
    $OUT = '(point to the server itself)';
  } else {
    $winsServerIp = $smb{WinsServerIP};
    $OUT = '(other server)';
  }
}
wins server = { $winsServerIp }
remote announce = { $winsServerIp }
remote browse sync = { $winsServerIp }

; Guest access (#1882). Shares must be guest-ok, to allow it.
map to guest = Bad User
